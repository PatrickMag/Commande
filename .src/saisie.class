' Gambas class file

Private $bCreer As Boolean
Private $lNumcom As Long
Private $scrolcam As Container
Private $resdte As Result



Public Sub _new(sChoix As String, dte As Date, lNumcom As Long, cam As Container)
  
  Dim st As ResultField
  
  $scrolcam = cam
  $lNumcom = lNumcom
                                   'combobox peut venir d'un fichier 
  ComboBox1.Add("MATIN")
  ComboBox1.Add("APREM")
  ComboBox1.Add("JOUR")
       
  Connect.ccon.Begin
  Select Case sChoix
    Case "ouvrir"
      $resdte = Connect.ccon.edit("datedelivraison", "idlivraison=&1 AND datelivr=&2", lNumcom, dte)
      DateBox1.Value = dte
      TextArea1.Text = $resdte!datecommentaire
      ComboBox1.Current.Text = $resdte!mataprem
      $bCreer = False
     
    Case "creer"
      $resdte = Connect.ccon.Create("datedelivraison")
      $resdte!idlivraison = $lNumcom
      $resdte!datelivr = dte
      DateBox1.Value = dte
      $bCreer = True
      Butsup.Enabled = False
      Butcam.Enabled = False
      
  End Select
End

Public Sub Butval_Click()
  
  $resdte!mataprem = ComboBox1.Current.Text
  $resdte!datecommentaire = TextArea1.Text
  $resdte.Update
  Connect.ccon.Commit
  $resdte = Connect.ccon.edit("datedelivraison", "idlivraison=&1 AND datelivr=&2", $lNumcom, DateBox1.Value)
  If $bCreer Then
    Butsup.Enabled = True
    Butcam.Enabled = True
    $bCreer = False
  Endif
  
End

Public Sub Butsup_Click()
  Dim qst As Integer
  
  qst = Message.Delete("Etes-vous sur de vouloir supprimer cette date ?", "OUI", "NON")
  If qst = 1 Then
    Connect.ccon.Rollback
    Connect.ccon.Delete("datedelivraison", "idlivraison=&1 AND datelivr=&2", $lNumcom, DateBox1.Value)
    Connect.ccon.Commit
    
    Me.Close
'   
  Endif
  
End

Public Sub Butcam_Click()
  
  Dim cam As Camion
  
  cam = New Camion("creer", $lNumcom, $scrolcam, 0, DateBox1.Value, $resdte!mataprem)
  cam.Tag = $lNumcom
  
  
End


